!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=null;t.gl=a,t.initGL=function(e){function r(e){Demopage.setErrorMessage("webgl-support",e)}var n=Canvas.getCanvas();if(t.gl=a=n.getContext("webgl",e),null==a){if(t.gl=a=n.getContext("experimental-webgl",e),null==a)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),a.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=Math.floor(a.canvas.clientWidth*t),n=Math.floor(a.canvas.clientHeight*t);a.canvas.width===r&&a.canvas.height===n||(a.canvas.width=r,a.canvas.height=n)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.default=a},function(e,t,r){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Skybox="skybox",e.Skysphere="skysphere",e.Tinyplanet="tinyplanet"}(a||(a={})),t.Format=a;var n=function(){function e(){}return e.guessFormat=function(t){if(e.mayBeSkybox(t))return a.Skybox;var r=t.width/t.height;return Math.abs(r-1)<.1?a.Tinyplanet:a.Skysphere},e.parseString=function(e){return e===a.Skybox?a.Skybox:e===a.Tinyplanet?a.Tinyplanet:a.Skysphere},e.ratio=function(e){return e===a.Skybox?4/3:e===a.Skysphere?2:1},e.mayBeSkybox=function(e){var t=document.createElement("canvas").getContext("2d");t.canvas.width=8,t.canvas.height=6,t.drawImage(e,0,0,t.canvas.width,t.canvas.height);for(var r=[{x:0,y:0},{x:5,y:0},{x:6,y:0},{x:7,y:0},{x:0,y:5},{x:5,y:5},{x:6,y:5},{x:7,y:5}],a=t.getImageData(r[0].x,r[0].y,1,1).data,n=0,i=r;n<i.length;n++)for(var o=i[n],s=t.getImageData(o.x,o.y,1,1).data,l=0;l<4;++l)if(s[l]!==a[l])return!1;return!0},e}();t.FormatUtils=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),n=new Array;function i(){for(var e=0,t=b.onChangeObservers;e<t.length;e++){(0,t[e])()}}var o,s=new Array;FileControl.addUploadObserver("file-upload-id",function(e){Canvas.showLoader(!0);var t=new FileReader;t.onload=function(){b.image=new Image,b.image.src=t.result},t.readAsDataURL(e[0])});var l,u,h=new Array;Tabs.addObserver("input-format",function(e){var t=l;l=a.FormatUtils.parseString(e[0]);for(var r=0,n=h;r<n.length;r++){(0,n[r])(t,l)}});var d;Tabs.addObserver("output-format",function(e){u=a.FormatUtils.parseString(e[0]),i()});var c;Checkbox.addObserver("output-preview-id",function(e){d=e,i()});var f;Range.addObserver("fov-range-id",function(e){c=Math.PI/180*e,i()});var v;Checkbox.addObserver("frame-checkbox-id",function(e){f=e,i()});var _;Range.addObserver("padding-top-range-id",function(e){v=e,i()});var p;Range.addObserver("padding-bottom-range-id",function(e){_=e,i()});var g;Range.addObserver("padding-back-range-id",function(e){p=e,i()});Checkbox.addObserver("flip-vertically-checkbox-id",function(e){g=e,i()}),Canvas.Observers.mouseWheel.push(function(e){b.fov+=10*e*Math.PI/180});var b=function(){function e(){}return Object.defineProperty(e,"onChangeObservers",{get:function(){return n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onInputFormatChangeObservers",{get:function(){return h},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onImageLoadObservers",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(e,"image",{get:function(){return o},set:function(e){(o=e).addEventListener("load",function(){Demopage.removeErrorMessage("invalid-image");for(var e=0,t=s;e<t.length;e++){(0,t[e])(o)}i()}),o.addEventListener("error",function(){Demopage.setErrorMessage("invalid-image","The image could not be loaded."),Canvas.showLoader(!1),console.error("Image could not be loaded.")})},enumerable:!0,configurable:!0}),Object.defineProperty(e,"inputFormat",{get:function(){return l},set:function(e){l=e,Tabs.setValues("input-format",[e]),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"previewOutput",{get:function(){return d},set:function(e){d=e,Checkbox.setChecked("output-preview-id",e),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"outputFormat",{get:function(){return u},set:function(e){u=e,Tabs.setValues("output-format",[e]),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"outputPercentage",{get:function(){return+Tabs.getValues("output-quality")[0]/100},enumerable:!0,configurable:!0}),Object.defineProperty(e,"fov",{get:function(){return c},set:function(e){Range.setValue("fov-range-id",180*e/Math.PI),c=Range.getValue("fov-range-id")*Math.PI/180,i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"showFrame",{get:function(){return f},set:function(e){f=e,Checkbox.setChecked("frame-checkbox-id",e),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"paddingTop",{get:function(){return v},set:function(e){Range.setValue("padding-top-range-id",e),v=Range.getValue("padding-top-range-id"),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"paddingBottom",{get:function(){return _},set:function(e){Range.setValue("padding-bottom-range-id",e),_=Range.getValue("padding-bottom-range-id"),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"paddingBack",{get:function(){return p},set:function(e){Range.setValue("padding-back-range-id",e),p=Range.getValue("padding-back-range-id"),i()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"flipVertically",{get:function(){return g},set:function(e){g=e,Checkbox.setChecked("flip-vertically-checkbox-id",e),i()},enumerable:!0,configurable:!0}),e}();t.Parameters=b;var m=document.createElement("style");m.type="text/css",m.innerHTML="canvas:active { cursor: grab; }",document.body.appendChild(m)},function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=a(r(9)),s=n(r(10)),l={};function u(e,t){var r=2,a=0;function n(n){if(n||a++,0===--r){var l=null;if(0===a){var u=s.getSource(e.vertexFilename),h=s.getSource(e.fragmentFilename);l=new o.default(i.gl,u,h)}t(l)}}s.loadSource(e.vertexFilename,n),s.loadSource(e.fragmentFilename,n)}t.getShader=function(e){return l[e].shader},t.buildShader=u,t.registerShader=function(e,t,r){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===l[e]){l[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var n=l[e];u(t,function(e){n.pending=!1,n.failed=null===e,n.shader=e,a(n)})}else{var i=l[e];!0===i.pending?i.callbacks.push(r):a(i)}},t.deleteShader=function(e){l[e]&&(l[e].shader&&l[e].shader.freeGLResources(),delete l[e])}},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,a,n){var i=e.call(this,t)||this;return i.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i.id),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i.size=a,i.type=n,i.normalize=!1,i.stride=0,i.offset=0,i}return n(t,e),t.createQuad=function(e,r,a,n,i){return new t(e,new Float32Array([r,a,n,a,r,i,n,i]),2,e.FLOAT)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t}(i(r(1)).default);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r){this._val=new Float32Array(3),this._val[0]=e,this._val[1]=t,this._val[2]=r}return e.dotProduct=function(e,t){return e._val[0]*t._val[0]+e._val[1]*t._val[1]+e._val[2]*t._val[2]},e.crossProduct=function(t,r){return new e(t._val[1]*r._val[2]-t._val[2]*r._val[1],t._val[2]*r._val[0]-t._val[0]*r._val[2],t._val[0]*r._val[1]-t._val[1]*r._val[0])},e.substract=function(t,r){return new e(t._val[0]-r._val[0],t._val[1]-r._val[1],t._val[2]-r._val[2])},Object.defineProperty(e.prototype,"x",{get:function(){return this._val[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._val[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._val[2]},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return Math.abs(this._val[0]-e._val[0])<1e-4&&Math.abs(this._val[1]-e._val[1])<1e-4&&Math.abs(this._val[2]-e._val[2])<1e-4},e.prototype.divideByScalar=function(e){this._val[0]/=e,this._val[1]/=e,this._val[2]/=e},e.prototype.substract=function(e){this._val[0]-=e._val[0],this._val[1]-=e._val[1],this._val[2]-=e._val[2]},Object.defineProperty(e.prototype,"length",{get:function(){var e=this._val[0]*this._val[0]+this._val[1]*this._val[1]+this._val[2]*this._val[2];return Math.sqrt(e)},enumerable:!0,configurable:!0}),e.prototype.normalize=function(){return Math.abs(this._val[0])<1e-4&&Math.abs(this._val[1])<1e-4&&Math.abs(this._val[2])<1e-4?(this._val[0]=0,this._val[1]=0,this._val[2]=0,!1):(this.divideByScalar(this.length),!0)},e}();t.Vec3=a},function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=a(r(8)),o=r(2),s=n(r(0)),l=r(0),u=a(r(11)),h=r(3),d=a(r(12));!function(){function e(){h.Parameters.paddingTop=0,h.Parameters.paddingBottom=0,h.Parameters.paddingBack=0,h.Parameters.flipVertically=!1}if(Canvas.showLoader(!0),h.Parameters.onImageLoadObservers.push(e),h.Parameters.image=new Image,h.Parameters.image.src="./images/skybox.jpg",h.Parameters.inputFormat=o.Format.Skybox,h.Parameters.outputFormat=o.Format.Skysphere,h.Parameters.previewOutput=!1,h.Parameters.fov=70*Math.PI/180,h.Parameters.showFrame=!1,e(),s.initGL({alpha:!1,preserveDrawingBuffer:!0})){var t=new d.default,r=new i.default,a=!1;FileControl.addDownloadObserver("file-download-id",function(){var e=h.Parameters.image.width*h.Parameters.outputPercentage,n=Math.pow(2,Math.floor(Math.log(e)*Math.LOG2E)),i=n/o.FormatUtils.ratio(h.Parameters.outputFormat),d=Canvas.getCanvas();function c(){d.style.position="",d.style.width="",d.style.height="",a=!0}if(d.style.position="absolute",d.style.width=n+"px",d.style.height=i+"px",d.width=n,d.height=i,s.adjustSize(),u.default.setFullCanvas(l.gl),l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT),r.draw(t.texture),l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT),r.draw(t.texture),d.msToBlob){var f=d.msToBlob();window.navigator.msSaveBlob(f,"image.png"),c()}else d.toBlob(function(e){var t=document.createElement("a");t.download="image.png",t.href=URL.createObjectURL(e),t.click(),c()})});var n=new u.default(0,0,1,1);requestAnimationFrame(function e(){t.update(),(t.needToRedraw||a)&&(s.adjustSize(),u.default.setFullCanvas(l.gl),l.gl.clear(l.gl.COLOR_BUFFER_BIT|l.gl.DEPTH_BUFFER_BIT),t.draw(),h.Parameters.previewOutput&&(n.width=.3*l.gl.drawingBufferWidth,n.height=n.width/o.FormatUtils.ratio(h.Parameters.outputFormat),n.set(l.gl),r.draw(t.texture)),a=!1),requestAnimationFrame(e)})}}()},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),l=i(r(1)),u=o(r(4)),h=i(r(5)),d=r(2),c=r(3),f=function(e){function t(){var t=e.call(this,s.gl)||this;return t._vbo=h.default.createQuad(s.gl,-1,-1,1,1),t.buildShader("_shaderBoxToBox","converter.vert","converterBoxToBox.frag"),t.buildShader("_shaderBoxToPlanet","converter.vert","converterBoxToPlanet.frag"),t.buildShader("_shaderBoxToSphere","converter.vert","converterBoxToSphere.frag"),t.buildShader("_shaderSphereToBox","converter.vert","converterSphereToBox.frag"),t.buildShader("_shaderSphereToPlanet","converter.vert","converterSphereToPlanet.frag"),t.buildShader("_shaderSphereToSphere","converter.vert","converterSphereToSphere.frag"),t.buildShader("_shaderPlanetToBox","converter.vert","converterPlanetToBox.frag"),t.buildShader("_shaderPlanetToPlanet","converter.vert","converterPlanetToPlanet.frag"),t.buildShader("_shaderPlanetToSphere","converter.vert","converterPlanetToSphere.frag"),t}return n(t,e),t.prototype.freeGLResources=function(){this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this.deleteShader("_shaderBoxToBox"),this.deleteShader("_shaderBoxToPlanet"),this.deleteShader("_shaderBoxToSphere"),this.deleteShader("_shaderSphereToBox"),this.deleteShader("_shaderSphereToPlanet"),this.deleteShader("_shaderSphereToSphere"),this.deleteShader("_shaderPlanetToBox"),this.deleteShader("_shaderPlanetToPlanet"),this.deleteShader("_shaderPlanetToSphere")},t.prototype.draw=function(e){var t=this.getShader(c.Parameters.inputFormat,c.Parameters.outputFormat);t&&(t.u.uTexture.value=e,t.u.uPaddingTop.value=c.Parameters.paddingTop,t.u.uPaddingBottom.value=c.Parameters.paddingBottom,t.u.uPaddingBack.value=c.Parameters.paddingBack,t.u.uFlipVertically.value=c.Parameters.flipVertically?-1:1,t.use(),t.bindUniformsAndAttributes(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4))},t.prototype.deleteShader=function(e){this[e]&&(this[e].freeGLResources(),this[e]=null)},t.prototype.buildShader=function(e,t,r){var a=this;u.buildShader({fragmentFilename:r,vertexFilename:t},function(t){null!==t&&(a[e]=t,a[e].a.aCorner.VBO=a._vbo)})},t.prototype.getShader=function(e,t){return e===d.Format.Skybox?t===d.Format.Skybox?this._shaderBoxToBox:t===d.Format.Skysphere?this._shaderBoxToSphere:this._shaderBoxToPlanet:e===d.Format.Skysphere?t===d.Format.Skybox?this._shaderSphereToBox:t===d.Format.Skysphere?this._shaderSphereToSphere:this._shaderSphereToPlanet:e===d.Format.Tinyplanet?t===d.Format.Skybox?this._shaderPlanetToBox:t===d.Format.Skysphere?this._shaderPlanetToSphere:this._shaderPlanetToPlanet:void 0},t}(l.default);t.default=f},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(r(1));function s(e,t,r){alert("NOT IMPLEMENTED YET")}var l={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,a)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,a)}},5120:{str:"BYTE",binder:s},5121:{str:"UNSIGNED_BYTE",binder:s},5122:{str:"SHORT",binder:s},5123:{str:"UNSIGNED_SHORT",binder:s},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:s},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},u=function(e){function t(t,r,a){var n=this;function i(e,r){var a=t.createShader(e);return t.shaderSource(a,r),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.error(t.getShaderInfoLog(a)),t.deleteShader(a),null)}(n=e.call(this,t)||this).id=null,n.uCount=0,n.aCount=0;var o=i(t.VERTEX_SHADER,r),s=i(t.FRAGMENT_SHADER,a),l=t.createProgram();return t.attachShader(l,o),t.attachShader(l,s),t.linkProgram(l),t.getProgramParameter(l,t.LINK_STATUS)?(n.id=l,n.introspection()):(console.error(t.getProgramInfoLog(l)),t.deleteProgram(l)),n}return n(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),a=0;Object.keys(this.u).forEach(function(e){var n=t.u[e];if(null!==n.value)if(35678===n.type||35680===n.type){var i=a;l[n.type].binder(r,n.loc,i,n.value),a++}else l[n.type].binder(r,n.loc,n.value)})},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach(function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)})},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u=[];for(var r=0;r<this.uCount;++r){var a=t.getActiveUniform(this.id,r),n=a.name;this.u[n]={loc:t.getUniformLocation(this.id,n),size:a.size,type:a.type,value:null}}this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a=[];for(r=0;r<this.aCount;++r){var i=t.getActiveAttrib(this.id,r),o=i.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:i.size,type:i.type}}},t}(o.default);t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};t.loadSource=function(e,t){function r(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===a[e]){a[e]={callbacks:[t],failed:!1,pending:!0,text:null};var n=a[e],i=new XMLHttpRequest;i.open("GET","./shaders/"+e,!0),i.onload=function(){4===i.readyState&&(n.pending=!1,200===i.status?(n.text=i.responseText,n.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+i.statusText),n.failed=!0),r(n))},i.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+i.statusText),n.pending=!1,n.failed=!0,r(n)},i.send(null)}else{var o=a[e];!0===o.pending?o.callbacks.push(t):r(o)}},t.getSource=function(e){return a[e].text}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,a){this.left=e,this.lower=t,this.width=r,this.height=a}return e.setFullCanvas=function(e){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)},e.prototype.set=function(e){e.viewport(this.lower,this.left,this.width,this.height)},e}();t.default=a},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),l=i(r(1)),u=o(r(4)),h=i(r(5)),d=r(13),c=r(6),f=r(2),v=r(3),_=function(e){function t(){var t=e.call(this,s.gl)||this;t._eyePos=new c.Vec3(0,0,0),t._vertical=new c.Vec3(0,0,1),t._tmpMatrix=new d.Mat4,t._projToWorldMatrix=new d.Mat4,t.resetThetaPhi(),t._needToReloadImage=!1,t._needToRedraw=!0;var r=function(){t._needToRedraw=!0},a=function(){r(),t.resetThetaPhi(),t._needToReloadImage=!0};return v.Parameters.onInputFormatChangeObservers.push(function(e,t){e===f.Format.Skybox||t===f.Format.Skybox?(Canvas.showLoader(!0),a()):r()}),v.Parameters.onChangeObservers.push(r),Canvas.Observers.canvasResize.push(r),Canvas.Observers.mouseDrag.push(r),t._vbo=h.default.createQuad(s.gl,-1,-1,1,1),t.buildShader("_shaderSkysphere","viewer.vert","viewerSkysphere.frag"),t.buildShader("_shaderSkybox","viewer.vert","viewerSkybox.frag"),t.buildShader("_shaderTinyplanet","viewer.vert","viewerTinyplanet.frag"),Canvas.Observers.mouseDrag.push(function(e,a){t._phi+=v.Parameters.fov*Canvas.getAspectRatio()*e,t._theta-=v.Parameters.fov*a,t._theta=Math.min(Math.PI-.001,Math.max(.001,t._theta)),r()}),v.Parameters.onImageLoadObservers.push(function(e){v.Parameters.inputFormat=f.FormatUtils.guessFormat(e),a()}),t}return n(t,e),t.prototype.freeGLResources=function(){this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this._texture&&(s.gl.deleteTexture(this._texture),this._texture=null),this._shaderSkybox&&(this._shaderSkybox.freeGLResources(),this._shaderSkybox=null),this._shaderSkysphere&&(this._shaderSkysphere.freeGLResources(),this._shaderSkysphere=null),this._shaderTinyplanet&&(this._shaderTinyplanet.freeGLResources(),this._shaderTinyplanet=null)},Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needToRedraw",{get:function(){return this._needToRedraw},enumerable:!0,configurable:!0}),t.prototype.update=function(){this._needToReloadImage&&(v.Parameters.inputFormat===f.Format.Skybox?this.splitAndLoadSkybox(v.Parameters.image):this.loadTexture(v.Parameters.image),this._needToReloadImage=!1,Canvas.showLoader(!1))},t.prototype.draw=function(){var e;(e=v.Parameters.inputFormat===f.Format.Skybox?this._shaderSkybox:v.Parameters.inputFormat===f.Format.Skysphere?this._shaderSkysphere:this._shaderTinyplanet)&&(this.recomputeMatrices(),e.u.uProjToWorld.value=this._projToWorldMatrix.val,e.u.uTexture.value=this._texture,e.u.uPaddingTop.value=v.Parameters.paddingTop,e.u.uPaddingBottom.value=v.Parameters.paddingBottom,e.u.uPaddingBack.value=v.Parameters.paddingBack,e.u.uFlipVertically.value=v.Parameters.flipVertically?-1:1,e.u.uShowFrame.value=v.Parameters.showFrame?1:0,e.use(),e.bindUniformsAndAttributes(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)),this._needToRedraw=!1},t.prototype.resetThetaPhi=function(){this._theta=.5*Math.PI,this._phi=0,this._needToRedraw=!0},t.prototype.loadTexture=function(e){s.gl.deleteTexture(this._texture),this._texture=s.gl.createTexture(),s.gl.bindTexture(s.gl.TEXTURE_2D,this._texture),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,s.gl.RGBA,s.gl.UNSIGNED_BYTE,e),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_WRAP_S,s.gl.CLAMP_TO_EDGE),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_WRAP_T,s.gl.CLAMP_TO_EDGE),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MIN_FILTER,s.gl.LINEAR),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MAG_FILTER,s.gl.LINEAR)},t.prototype.splitAndLoadSkybox=function(e){var t,r=(t=Math.floor(Math.max(e.width/4,e.height/3)),Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)));s.gl.deleteTexture(this._texture),this._texture=s.gl.createTexture();var a=document.createElement("canvas").getContext("2d");a.canvas.width=r,a.canvas.height=r;var n=[{target:s.gl.TEXTURE_CUBE_MAP_POSITIVE_X,position:{x:2,y:1},rotation:.5*Math.PI},{target:s.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,position:{x:0,y:1},rotation:-.5*Math.PI},{target:s.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,position:{x:1,y:1},rotation:-Math.PI},{target:s.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,position:{x:3,y:1},rotation:0},{target:s.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,position:{x:1,y:0},rotation:Math.PI},{target:s.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,position:{x:1,y:2},rotation:0}];s.gl.bindTexture(s.gl.TEXTURE_CUBE_MAP,this._texture),a.translate(r,0),a.scale(-1,1);for(var i=e.width/4,o=e.height/3,l=0,u=n;l<u.length;l++){var h=u[l];a.translate(.5*r,.5*r),a.rotate(h.rotation),a.translate(-.5*r,-.5*r),a.drawImage(e,h.position.x*i,h.position.y*o,i,o,0,0,r,r),s.gl.texImage2D(h.target,0,s.gl.RGBA,s.gl.RGBA,s.gl.UNSIGNED_BYTE,a.canvas),a.translate(.5*r,.5*r),a.rotate(-h.rotation),a.translate(-.5*r,-.5*r)}s.gl.generateMipmap(s.gl.TEXTURE_CUBE_MAP),s.gl.texParameteri(s.gl.TEXTURE_CUBE_MAP,s.gl.TEXTURE_MIN_FILTER,s.gl.LINEAR_MIPMAP_LINEAR),s.gl.texParameteri(s.gl.TEXTURE_CUBE_MAP,s.gl.TEXTURE_MAG_FILTER,s.gl.LINEAR)},t.prototype.buildShader=function(e,t,r){var a=this;u.buildShader({fragmentFilename:r,vertexFilename:t},function(t){null!==t&&(a[e]=t,a[e].a.aCorner.VBO=a._vbo,a._needToRedraw=!0)})},t.prototype.recomputeMatrices=function(){var e=new c.Vec3(Math.sin(this._theta)*Math.cos(this._phi),Math.sin(this._theta)*Math.sin(this._phi),Math.cos(this._theta));this._projToWorldMatrix.lookAt(this._eyePos,e,this._vertical),this._projToWorldMatrix.invert();var t=s.gl.canvas.clientWidth/s.gl.canvas.clientHeight;this._tmpMatrix.perspectiveInverse(v.Parameters.fov,t,.1,1/0),this._projToWorldMatrix.multiplyRight(this._tmpMatrix)},t}(l.default);t.default=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(6),n=function(){function e(){this._val=new Float32Array(16),this.identity()}return Object.defineProperty(e,"tmpMatrix",{get:function(){return null===e._tmpMatrix&&(e._tmpMatrix=new e),e._tmpMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"val",{get:function(){return this._val},enumerable:!0,configurable:!0}),e.prototype.identity=function(){for(var e=0;e<16;++e)this._val[e]=0;this._val[0]=1,this._val[5]=1,this._val[10]=1,this._val[15]=1},e.prototype.lookAt=function(e,t,r){if(e.equals(t))this.identity();else{var n=a.Vec3.substract(e,t);n.normalize();var i=a.Vec3.crossProduct(r,n);i.normalize();var o=a.Vec3.crossProduct(n,i);o.normalize(),this._val[0]=i.x,this._val[1]=o.x,this._val[2]=n.x,this._val[3]=0,this._val[4]=i.y,this._val[5]=o.y,this._val[6]=n.y,this._val[7]=0,this._val[8]=i.z,this._val[9]=o.z,this._val[10]=n.z,this._val[11]=0,this._val[12]=-a.Vec3.dotProduct(i,e),this._val[13]=-a.Vec3.dotProduct(o,e),this._val[14]=-a.Vec3.dotProduct(n,e),this._val[15]=1}},e.prototype.multiplyRight=function(t){for(var r=e.tmpMatrix._val,a=this._val,n=t._val,i=0;i<4;++i)for(var o=0;o<4;++o){r[4*i+o]=0;for(var s=0;s<4;++s)r[4*i+o]+=a[4*s+o]*n[4*i+s]}this.swapWithTmpMatrix()},e.prototype.invert=function(){var t=this._val,r=t[0],a=t[1],n=t[2],i=t[3],o=t[4],s=t[5],l=t[6],u=t[7],h=t[8],d=t[9],c=t[10],f=t[11],v=t[12],_=t[13],p=t[14],g=t[15],b=r*s-a*o,m=r*l-n*o,y=r*u-i*o,T=a*l-n*s,P=a*u-i*s,x=n*u-i*l,S=h*_-d*v,E=h*p-c*v,O=h*g-f*v,M=d*p-c*_,R=d*g-f*_,w=c*g-f*p,A=b*w-m*R+y*M+T*O-P*E+x*S;if(!A)return!1;A=1/A;var B=e.tmpMatrix._val;return B[0]=(s*w-l*R+u*M)*A,B[1]=(n*R-a*w-i*M)*A,B[2]=(_*x-p*P+g*T)*A,B[3]=(c*P-d*x-f*T)*A,B[4]=(l*O-o*w-u*E)*A,B[5]=(r*w-n*O+i*E)*A,B[6]=(p*y-v*x-g*m)*A,B[7]=(h*x-c*y+f*m)*A,B[8]=(o*R-s*O+u*S)*A,B[9]=(a*O-r*R-i*S)*A,B[10]=(v*P-_*y+g*b)*A,B[11]=(d*y-h*P-f*b)*A,B[12]=(s*E-o*M-l*S)*A,B[13]=(r*M-a*E+n*S)*A,B[14]=(_*m-v*T-p*b)*A,B[15]=(h*T-d*m+c*b)*A,this.swapWithTmpMatrix(),!0},e.prototype.perspective=function(e,t,r,a){var n=1/Math.tan(e/2);if(this._val[0]=n/t,this._val[1]=0,this._val[2]=0,this._val[3]=0,this._val[4]=0,this._val[5]=n,this._val[6]=0,this._val[7]=0,this._val[8]=0,this._val[9]=0,this._val[11]=-1,this._val[12]=0,this._val[13]=0,this._val[15]=0,a===1/0)this._val[10]=-1,this._val[14]=-2*r;else{var i=1/(r-a);this._val[10]=(a+r)*i,this._val[14]=2*a*r*i}},e.prototype.perspectiveInverse=function(e,t,r,a){var n=Math.tan(e/2);if(this._val[0]=t*n,this._val[1]=0,this._val[2]=0,this._val[3]=0,this._val[4]=0,this._val[5]=n,this._val[6]=0,this._val[7]=0,this._val[8]=0,this._val[9]=0,this._val[10]=0,this._val[12]=0,this._val[13]=0,this._val[14]=-1,a===1/0)this._val[11]=-.5,this._val[15]=.5/r;else{var i=.5/(r*a);this._val[11]=(r-a)*i,this._val[15]=(r+a)*i}},e.prototype.swapWithTmpMatrix=function(){var t=e.tmpMatrix._val;e.tmpMatrix._val=this._val,this._val=t},e._tmpMatrix=null,e}();t.Mat4=n}]);