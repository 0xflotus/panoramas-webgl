!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(1);var a=null;t.gl=a,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var n=Page.Canvas.getCanvas();if(t.gl=a=n.getContext("webgl",e),null==a){if(t.gl=a=n.getContext("experimental-webgl",e),null==a)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),a.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=a.canvas,n=Math.floor(r.clientWidth*t),i=Math.floor(r.clientHeight*t);r.width===n&&r.height===i||(r.width=n,r.height=i)}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.default=a},function(e,t,r){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.FormatUtils=t.Format=void 0,function(e){e.Skybox="skybox",e.Skysphere="skysphere",e.Tinyplanet="tinyplanet"}(a||(a={})),t.Format=a;var n=function(){function e(){}return e.guessFormat=function(t){if(e.mayBeSkybox(t))return a.Skybox;var r=t.width/t.height;return Math.abs(r-1)<.1?a.Tinyplanet:a.Skysphere},e.parseString=function(e){return e===a.Skybox?a.Skybox:e===a.Tinyplanet?a.Tinyplanet:a.Skysphere},e.ratio=function(e){return e===a.Skybox?4/3:e===a.Skysphere?2:1},e.mayBeSkybox=function(e){var t=document.createElement("canvas").getContext("2d");t.canvas.width=8,t.canvas.height=6,t.drawImage(e,0,0,t.canvas.width,t.canvas.height);for(var r=[{x:0,y:0},{x:5,y:0},{x:6,y:0},{x:7,y:0},{x:0,y:5},{x:5,y:5},{x:6,y:5},{x:7,y:5}],a=t.getImageData(r[0].x,r[0].y,1,1).data,n=0,i=r;n<i.length;n++)for(var o=i[n],s=t.getImageData(o.x,o.y,1,1).data,u=0;u<4;++u)if(s[u]!==a[u])return!1;return!0},e}();t.FormatUtils=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0;var a=r(3);r(1);var n=new Array;function i(){for(var e=0,t=m.onChangeObservers;e<t.length;e++){(0,t[e])()}}var o,s=new Array;Page.FileControl.addUploadObserver("file-upload-id",(function(e){Page.Canvas.showLoader(!0);var t=new FileReader;t.onload=function(){m.image=new Image,m.image.src=t.result},t.readAsDataURL(e[0])}));var u,l,d=new Array;Page.Tabs.addObserver("input-format",(function(e){var t=u;u=a.FormatUtils.parseString(e[0]);for(var r=0,n=d;r<n.length;r++){(0,n[r])(t,u)}}));var c;Page.Tabs.addObserver("output-format",(function(e){l=a.FormatUtils.parseString(e[0]),i()}));var h;Page.Checkbox.addObserver("output-preview-id",(function(e){c=e,i()}));var f;Page.Range.addObserver("fov-range-id",(function(e){h=Math.PI/180*e,i()}));var v;Page.Checkbox.addObserver("frame-checkbox-id",(function(e){f=e,i()}));var _;Page.Range.addObserver("padding-top-range-id",(function(e){v=e,i()}));var p;Page.Range.addObserver("padding-bottom-range-id",(function(e){_=e,i()}));var g;Page.Range.addObserver("padding-back-range-id",(function(e){p=e,i()}));var b;Page.Range.addObserver("rotate-z-range-id",(function(e){g=e,i()}));Page.Checkbox.addObserver("flip-vertically-checkbox-id",(function(e){b=e,i()})),Page.Canvas.Observers.mouseWheel.push((function(e){m.fov+=10*e*Math.PI/180}));var m=function(){function e(){}return Object.defineProperty(e,"onChangeObservers",{get:function(){return n},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onInputFormatChangeObservers",{get:function(){return d},enumerable:!1,configurable:!0}),Object.defineProperty(e,"onImageLoadObservers",{get:function(){return s},enumerable:!1,configurable:!0}),Object.defineProperty(e,"image",{get:function(){return o},set:function(e){(o=e).addEventListener("load",(function(){Page.Demopage.removeErrorMessage("invalid-image");for(var e=0,t=s;e<t.length;e++){(0,t[e])(o)}i()})),o.addEventListener("error",(function(){Page.Demopage.setErrorMessage("invalid-image","The image could not be loaded."),Page.Canvas.showLoader(!1),console.error("Image could not be loaded.")}))},enumerable:!1,configurable:!0}),Object.defineProperty(e,"inputFormat",{get:function(){return u},set:function(e){u=e,Page.Tabs.setValues("input-format",[e]),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"previewOutput",{get:function(){return c},set:function(e){c=e,Page.Checkbox.setChecked("output-preview-id",e),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"outputFormat",{get:function(){return l},set:function(e){l=e,Page.Tabs.setValues("output-format",[e]),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"outputPercentage",{get:function(){return+Page.Tabs.getValues("output-quality")[0]/100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"fov",{get:function(){return h},set:function(e){Page.Range.setValue("fov-range-id",180*e/Math.PI),h=Page.Range.getValue("fov-range-id")*Math.PI/180,i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"showFrame",{get:function(){return f},set:function(e){f=e,Page.Checkbox.setChecked("frame-checkbox-id",e),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paddingTop",{get:function(){return v},set:function(e){Page.Range.setValue("padding-top-range-id",e),v=Page.Range.getValue("padding-top-range-id"),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paddingBottom",{get:function(){return _},set:function(e){Page.Range.setValue("padding-bottom-range-id",e),_=Page.Range.getValue("padding-bottom-range-id"),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"paddingBack",{get:function(){return p},set:function(e){Page.Range.setValue("padding-back-range-id",e),p=Page.Range.getValue("padding-back-range-id"),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"rotateZ",{get:function(){return g},set:function(e){Page.Range.setValue("rotate-z-range-id",e),g=Page.Range.getValue("rotate-z-range-id"),i()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"flipVertically",{get:function(){return b},set:function(e){b=e,Page.Checkbox.setChecked("flip-vertically-checkbox-id",e),i()},enumerable:!1,configurable:!0}),e}();t.Parameters=m;var y=document.createElement("style");y.type="text/css",y.innerHTML="canvas:active { cursor: grab; }",document.body.appendChild(y)},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var s=r(0),u=o(r(10)),l=i(r(11)),d={};function c(e,t){var r=2,a=0;function n(n){if(r--,n||a++,0===r){var i=null;if(0===a){var o=l.getSource(e.vertexFilename),d=l.getSource(e.fragmentFilename);i=new u.default(s.gl,o,d)}t(i)}}l.loadSource(e.vertexFilename,n),l.loadSource(e.fragmentFilename,n)}t.getShader=function(e){return d[e].shader},t.buildShader=c,t.registerShader=function(e,t,r){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++){(0,r[t])(!e.failed,e.shader)}e.callbacks=[]}if(void 0===d[e]){d[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var n=d[e];c(t,(function(e){n.pending=!1,n.failed=null===e,n.shader=e,a(n)}))}else{var i=d[e];!0===i.pending?i.callbacks.push(r):a(i)}},t.deleteShader=function(e){d[e]&&(d[e].shader&&d[e].shader.freeGLResources(),delete d[e])}},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,a,n){var i=e.call(this,t)||this;return i.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i.id),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i.size=a,i.type=n,i.normalize=!1,i.stride=0,i.offset=0,i}return n(t,e),t.createQuad=function(e,r,a,n,i){return new t(e,new Float32Array([r,a,n,a,r,i,n,i]),2,e.FLOAT)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t}(i(r(2)).default);t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vec3=void 0;var a=function(){function e(e,t,r){this._val=new Float32Array(3),this._val[0]=e,this._val[1]=t,this._val[2]=r}return e.dotProduct=function(e,t){return e._val[0]*t._val[0]+e._val[1]*t._val[1]+e._val[2]*t._val[2]},e.crossProduct=function(t,r){return new e(t._val[1]*r._val[2]-t._val[2]*r._val[1],t._val[2]*r._val[0]-t._val[0]*r._val[2],t._val[0]*r._val[1]-t._val[1]*r._val[0])},e.substract=function(t,r){return new e(t._val[0]-r._val[0],t._val[1]-r._val[1],t._val[2]-r._val[2])},Object.defineProperty(e.prototype,"x",{get:function(){return this._val[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._val[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._val[2]},enumerable:!1,configurable:!0}),e.prototype.equals=function(e){return Math.abs(this._val[0]-e._val[0])<1e-4&&Math.abs(this._val[1]-e._val[1])<1e-4&&Math.abs(this._val[2]-e._val[2])<1e-4},e.prototype.divideByScalar=function(e){this._val[0]/=e,this._val[1]/=e,this._val[2]/=e},e.prototype.substract=function(e){this._val[0]-=e._val[0],this._val[1]-=e._val[1],this._val[2]-=e._val[2]},Object.defineProperty(e.prototype,"length",{get:function(){var e=this._val[0]*this._val[0]+this._val[1]*this._val[1]+this._val[2]*this._val[2];return Math.sqrt(e)},enumerable:!1,configurable:!0}),e.prototype.normalize=function(){return Math.abs(this._val[0])<1e-4&&Math.abs(this._val[1])<1e-4&&Math.abs(this._val[2])<1e-4?(this._val[0]=0,this._val[1]=0,this._val[2]=0,!1):(this.divideByScalar(this.length),!0)},e}();t.Vec3=a},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(9)),u=r(3),l=i(r(0)),d=r(0),c=o(r(12)),h=r(4),f=o(r(13));r(1),function(){function e(){h.Parameters.paddingTop=0,h.Parameters.paddingBottom=0,h.Parameters.paddingBack=0,h.Parameters.rotateZ=0,h.Parameters.flipVertically=!1}if(Page.Canvas.showLoader(!0),h.Parameters.onImageLoadObservers.push(e),h.Parameters.image=new Image,h.Parameters.image.src="./images/skybox.jpg",h.Parameters.inputFormat=u.Format.Skybox,h.Parameters.outputFormat=u.Format.Skysphere,h.Parameters.previewOutput=!1,h.Parameters.fov=70*Math.PI/180,h.Parameters.showFrame=!1,e(),l.initGL({alpha:!1,preserveDrawingBuffer:!0})){var t=new f.default,r=new s.default,a=!1;Page.FileControl.addDownloadObserver("file-download-id",(function(){var e=h.Parameters.image.width*h.Parameters.outputPercentage,n=Math.pow(2,Math.floor(Math.log(e)*Math.LOG2E)),i=n/u.FormatUtils.ratio(h.Parameters.outputFormat),o=Page.Canvas.getCanvas();function s(){o.style.position="",o.style.width="",o.style.height="",a=!0}if(o.style.position="absolute",o.style.width=n+"px",o.style.height=i+"px",o.width=n,o.height=i,l.adjustSize(),c.default.setFullCanvas(d.gl),d.gl.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT),r.draw(t.texture),d.gl.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT),r.draw(t.texture),o.msToBlob){var f=o.msToBlob();window.navigator.msSaveBlob(f,"image.png"),s()}else o.toBlob((function(e){var t=document.createElement("a");t.download="image.png",t.href=URL.createObjectURL(e),t.click(),s()}))}));var n=new c.default(0,0,1,1);requestAnimationFrame((function e(){t.update(),(t.needToRedraw||a)&&(l.adjustSize(),c.default.setFullCanvas(d.gl),d.gl.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT),t.draw(),h.Parameters.previewOutput&&(n.width=.3*d.gl.drawingBufferWidth,n.height=n.width/u.FormatUtils.ratio(h.Parameters.outputFormat),n.set(d.gl),r.draw(t.texture)),a=!1),requestAnimationFrame(e)}))}}()},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(0),d=u(r(2)),c=s(r(5)),h=u(r(6)),f=r(3),v=r(4),_=function(e){function t(){var t=e.call(this,l.gl)||this;return t._vbo=h.default.createQuad(l.gl,-1,-1,1,1),t.buildShader("_shaderBoxToBox","converter.vert","converterBoxToBox.frag"),t.buildShader("_shaderBoxToPlanet","converter.vert","converterBoxToPlanet.frag"),t.buildShader("_shaderBoxToSphere","converter.vert","converterBoxToSphere.frag"),t.buildShader("_shaderSphereToBox","converter.vert","converterSphereToBox.frag"),t.buildShader("_shaderSphereToPlanet","converter.vert","converterSphereToPlanet.frag"),t.buildShader("_shaderSphereToSphere","converter.vert","converterSphereToSphere.frag"),t.buildShader("_shaderPlanetToBox","converter.vert","converterPlanetToBox.frag"),t.buildShader("_shaderPlanetToPlanet","converter.vert","converterPlanetToPlanet.frag"),t.buildShader("_shaderPlanetToSphere","converter.vert","converterPlanetToSphere.frag"),t}return n(t,e),t.prototype.freeGLResources=function(){this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this.deleteShader("_shaderBoxToBox"),this.deleteShader("_shaderBoxToPlanet"),this.deleteShader("_shaderBoxToSphere"),this.deleteShader("_shaderSphereToBox"),this.deleteShader("_shaderSphereToPlanet"),this.deleteShader("_shaderSphereToSphere"),this.deleteShader("_shaderPlanetToBox"),this.deleteShader("_shaderPlanetToPlanet"),this.deleteShader("_shaderPlanetToSphere")},t.prototype.draw=function(e){var t=this.getShader(v.Parameters.inputFormat,v.Parameters.outputFormat);t&&e&&(t.u.uTexture.value=e,t.u.uPaddingTop.value=v.Parameters.paddingTop,t.u.uPaddingBottom.value=v.Parameters.paddingBottom,t.u.uPaddingBack.value=v.Parameters.paddingBack,t.u.uRotateZ.value=v.Parameters.rotateZ,t.u.uFlipVertically.value=v.Parameters.flipVertically?-1:1,t.use(),t.bindUniformsAndAttributes(),l.gl.drawArrays(l.gl.TRIANGLE_STRIP,0,4))},t.prototype.deleteShader=function(e){this[e]&&(this[e].freeGLResources(),this[e]=null)},t.prototype.buildShader=function(e,t,r){var a=this;c.buildShader({fragmentFilename:r,vertexFilename:t},(function(t){null!==t&&(a[e]=t,a[e].a.aCorner.VBO=a._vbo)}))},t.prototype.getShader=function(e,t){return e===f.Format.Skybox?t===f.Format.Skybox?this._shaderBoxToBox:t===f.Format.Skysphere?this._shaderBoxToSphere:this._shaderBoxToPlanet:e===f.Format.Skysphere?t===f.Format.Skybox?this._shaderSphereToBox:t===f.Format.Skysphere?this._shaderSphereToSphere:this._shaderSphereToPlanet:e===f.Format.Tinyplanet?t===f.Format.Skybox?this._shaderPlanetToBox:t===f.Format.Skysphere?this._shaderPlanetToSphere:this._shaderPlanetToPlanet:void 0},t}(d.default);t.default=_},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(r(2));function s(e,t,r){alert("NOT IMPLEMENTED YET")}var u={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,a)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,a)}},5120:{str:"BYTE",binder:s},5121:{str:"UNSIGNED_BYTE",binder:s},5122:{str:"SHORT",binder:s},5123:{str:"UNSIGNED_SHORT",binder:s},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:s},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},l=function(e){function t(t,r,a){var n=this;function i(e,r){var a=t.createShader(e);return t.shaderSource(a,r),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.error(t.getShaderInfoLog(a)),t.deleteShader(a),null)}(n=e.call(this,t)||this).id=null,n.uCount=0,n.aCount=0;var o=i(t.VERTEX_SHADER,r),s=i(t.FRAGMENT_SHADER,a),u=t.createProgram();return t.attachShader(u,o),t.attachShader(u,s),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)?(n.id=u,n.introspection()):(console.error(t.getProgramInfoLog(u)),t.deleteProgram(u)),n}return n(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),a=0;Object.keys(this.u).forEach((function(e){var n=t.u[e];if(null!==n.value)if(35678===n.type||35680===n.type){var i=a;u[n.type].binder(r,n.loc,i,n.value),a++}else u[n.type].binder(r,n.loc,n.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u=[];for(var r=0;r<this.uCount;++r){var a=t.getActiveUniform(this.id,r),n=a.name;this.u[n]={loc:t.getUniformLocation(this.id,n),size:a.size,type:a.type,value:null}}this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a=[];for(r=0;r<this.aCount;++r){var i=t.getActiveAttrib(this.id,r),o=i.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:i.size,type:i.type}}},t}(o.default);t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var a={};t.loadSource=function(e,t){function r(e){for(var t=0,r=e.callbacks;t<r.length;t++){(0,r[t])(!e.failed)}e.callbacks=[]}if(void 0===a[e]){a[e]={callbacks:[t],failed:!1,pending:!0,text:null};var n=a[e],i=new XMLHttpRequest;i.open("GET","./shaders/"+e,!0),i.onload=function(){4===i.readyState&&(n.pending=!1,200===i.status?(n.text=i.responseText,n.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+i.statusText),n.failed=!0),r(n))},i.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+i.statusText),n.pending=!1,n.failed=!0,r(n)},i.send(null)}else{var o=a[e];!0===o.pending?o.callbacks.push(t):r(o)}},t.getSource=function(e){return a[e].text}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,r,a){this.left=e,this.lower=t,this.width=r,this.height=a}return e.setFullCanvas=function(e){e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)},e.prototype.set=function(e){e.viewport(this.lower,this.left,this.width,this.height)},e}();t.default=a},function(e,t,r){"use strict";var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&i(t,e,r);return o(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=r(0),d=u(r(2)),c=s(r(5)),h=u(r(6)),f=r(14),v=r(7),_=r(3),p=r(4);r(1);var g=function(e){function t(){var t=e.call(this,l.gl)||this;t._eyePos=new v.Vec3(0,0,0),t._vertical=new v.Vec3(0,0,1),t._tmpMatrix=new f.Mat4,t._projToWorldMatrix=new f.Mat4,t.resetThetaPhi(),t._needToReloadImage=!1,t._needToRedraw=!0;var r=function(){t._needToRedraw=!0},a=function(){r(),t.resetThetaPhi(),t._needToReloadImage=!0};return p.Parameters.onInputFormatChangeObservers.push((function(e,t){e===_.Format.Skybox||t===_.Format.Skybox?(Page.Canvas.showLoader(!0),a()):r()})),p.Parameters.onChangeObservers.push(r),Page.Canvas.Observers.canvasResize.push(r),Page.Canvas.Observers.mouseDrag.push(r),t._vbo=h.default.createQuad(l.gl,-1,-1,1,1),t.buildShader("_shaderSkysphere","viewer.vert","viewerSkysphere.frag"),t.buildShader("_shaderSkybox","viewer.vert","viewerSkybox.frag"),t.buildShader("_shaderTinyplanet","viewer.vert","viewerTinyplanet.frag"),Page.Canvas.Observers.mouseDrag.push((function(e,a){t._phi+=p.Parameters.fov*Page.Canvas.getAspectRatio()*e,t._theta-=p.Parameters.fov*a,t._theta=Math.min(Math.PI-.001,Math.max(.001,t._theta)),r()})),p.Parameters.onImageLoadObservers.push((function(e){p.Parameters.inputFormat=_.FormatUtils.guessFormat(e),a()})),t}return n(t,e),t.prototype.freeGLResources=function(){this._vbo&&(this._vbo.freeGLResources(),this._vbo=null),this._texture&&(l.gl.deleteTexture(this._texture),this._texture=null),this._shaderSkybox&&(this._shaderSkybox.freeGLResources(),this._shaderSkybox=null),this._shaderSkysphere&&(this._shaderSkysphere.freeGLResources(),this._shaderSkysphere=null),this._shaderTinyplanet&&(this._shaderTinyplanet.freeGLResources(),this._shaderTinyplanet=null)},Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needToRedraw",{get:function(){return this._needToRedraw},enumerable:!1,configurable:!0}),t.prototype.update=function(){this._needToReloadImage&&(p.Parameters.inputFormat===_.Format.Skybox?this.splitAndLoadSkybox(p.Parameters.image):this.loadTexture(p.Parameters.image),this._needToReloadImage=!1,Page.Canvas.showLoader(!1))},t.prototype.draw=function(){var e;(e=p.Parameters.inputFormat===_.Format.Skybox?this._shaderSkybox:p.Parameters.inputFormat===_.Format.Skysphere?this._shaderSkysphere:this._shaderTinyplanet)&&this._texture&&(this.recomputeMatrices(),e.u.uProjToWorld.value=this._projToWorldMatrix.val,e.u.uTexture.value=this._texture,e.u.uPaddingTop.value=p.Parameters.paddingTop,e.u.uPaddingBottom.value=p.Parameters.paddingBottom,e.u.uPaddingBack.value=p.Parameters.paddingBack,e.u.uRotateZ.value=p.Parameters.rotateZ,e.u.uFlipVertically.value=p.Parameters.flipVertically?-1:1,e.u.uShowFrame.value=p.Parameters.showFrame?1:0,e.use(),e.bindUniformsAndAttributes(),l.gl.drawArrays(l.gl.TRIANGLE_STRIP,0,4)),this._needToRedraw=!1},t.prototype.resetThetaPhi=function(){this._theta=.5*Math.PI,this._phi=0,this._needToRedraw=!0},t.prototype.loadTexture=function(e){l.gl.deleteTexture(this._texture),this._texture=l.gl.createTexture(),l.gl.bindTexture(l.gl.TEXTURE_2D,this._texture),l.gl.texImage2D(l.gl.TEXTURE_2D,0,l.gl.RGBA,l.gl.RGBA,l.gl.UNSIGNED_BYTE,e),l.gl.texParameteri(l.gl.TEXTURE_2D,l.gl.TEXTURE_WRAP_S,l.gl.CLAMP_TO_EDGE),l.gl.texParameteri(l.gl.TEXTURE_2D,l.gl.TEXTURE_WRAP_T,l.gl.CLAMP_TO_EDGE),l.gl.texParameteri(l.gl.TEXTURE_2D,l.gl.TEXTURE_MIN_FILTER,l.gl.LINEAR),l.gl.texParameteri(l.gl.TEXTURE_2D,l.gl.TEXTURE_MAG_FILTER,l.gl.LINEAR)},t.prototype.splitAndLoadSkybox=function(e){var t,r=(t=Math.floor(Math.max(e.width/4,e.height/3)),Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)));l.gl.deleteTexture(this._texture),this._texture=l.gl.createTexture();var a=document.createElement("canvas").getContext("2d");a.canvas.width=r,a.canvas.height=r;var n=[{target:l.gl.TEXTURE_CUBE_MAP_POSITIVE_X,position:{x:2,y:1},rotation:.5*Math.PI},{target:l.gl.TEXTURE_CUBE_MAP_NEGATIVE_X,position:{x:0,y:1},rotation:-.5*Math.PI},{target:l.gl.TEXTURE_CUBE_MAP_POSITIVE_Y,position:{x:1,y:1},rotation:-Math.PI},{target:l.gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,position:{x:3,y:1},rotation:0},{target:l.gl.TEXTURE_CUBE_MAP_POSITIVE_Z,position:{x:1,y:0},rotation:Math.PI},{target:l.gl.TEXTURE_CUBE_MAP_NEGATIVE_Z,position:{x:1,y:2},rotation:0}];l.gl.bindTexture(l.gl.TEXTURE_CUBE_MAP,this._texture),a.translate(r,0),a.scale(-1,1);for(var i=e.width/4,o=e.height/3,s=0,u=n;s<u.length;s++){var d=u[s];a.translate(.5*r,.5*r),a.rotate(d.rotation),a.translate(-.5*r,-.5*r),a.drawImage(e,d.position.x*i,d.position.y*o,i,o,0,0,r,r),l.gl.texImage2D(d.target,0,l.gl.RGBA,l.gl.RGBA,l.gl.UNSIGNED_BYTE,a.canvas),a.translate(.5*r,.5*r),a.rotate(-d.rotation),a.translate(-.5*r,-.5*r)}l.gl.generateMipmap(l.gl.TEXTURE_CUBE_MAP),l.gl.texParameteri(l.gl.TEXTURE_CUBE_MAP,l.gl.TEXTURE_MIN_FILTER,l.gl.LINEAR_MIPMAP_LINEAR),l.gl.texParameteri(l.gl.TEXTURE_CUBE_MAP,l.gl.TEXTURE_MAG_FILTER,l.gl.LINEAR)},t.prototype.buildShader=function(e,t,r){var a=this;c.buildShader({fragmentFilename:r,vertexFilename:t},(function(t){null!==t&&(a[e]=t,a[e].a.aCorner.VBO=a._vbo,a._needToRedraw=!0)}))},t.prototype.recomputeMatrices=function(){var e=new v.Vec3(Math.sin(this._theta)*Math.cos(this._phi),Math.sin(this._theta)*Math.sin(this._phi),Math.cos(this._theta));this._projToWorldMatrix.lookAt(this._eyePos,e,this._vertical),this._projToWorldMatrix.invert();var t=l.gl.canvas,r=t.clientWidth/t.clientHeight;this._tmpMatrix.perspectiveInverse(p.Parameters.fov,r,.1,1/0),this._projToWorldMatrix.multiplyRight(this._tmpMatrix)},t}(d.default);t.default=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mat4=void 0;var a=r(7),n=function(){function e(){this._val=new Float32Array(16),this.identity()}return Object.defineProperty(e,"tmpMatrix",{get:function(){return null===e._tmpMatrix&&(e._tmpMatrix=new e),e._tmpMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"val",{get:function(){return this._val},enumerable:!1,configurable:!0}),e.prototype.identity=function(){for(var e=0;e<16;++e)this._val[e]=0;this._val[0]=1,this._val[5]=1,this._val[10]=1,this._val[15]=1},e.prototype.lookAt=function(e,t,r){if(e.equals(t))this.identity();else{var n=a.Vec3.substract(e,t);n.normalize();var i=a.Vec3.crossProduct(r,n);i.normalize();var o=a.Vec3.crossProduct(n,i);o.normalize(),this._val[0]=i.x,this._val[1]=o.x,this._val[2]=n.x,this._val[3]=0,this._val[4]=i.y,this._val[5]=o.y,this._val[6]=n.y,this._val[7]=0,this._val[8]=i.z,this._val[9]=o.z,this._val[10]=n.z,this._val[11]=0,this._val[12]=-a.Vec3.dotProduct(i,e),this._val[13]=-a.Vec3.dotProduct(o,e),this._val[14]=-a.Vec3.dotProduct(n,e),this._val[15]=1}},e.prototype.multiplyRight=function(t){for(var r=e.tmpMatrix._val,a=this._val,n=t._val,i=0;i<4;++i)for(var o=0;o<4;++o){r[4*i+o]=0;for(var s=0;s<4;++s)r[4*i+o]+=a[4*s+o]*n[4*i+s]}this.swapWithTmpMatrix()},e.prototype.invert=function(){var t=this._val,r=t[0],a=t[1],n=t[2],i=t[3],o=t[4],s=t[5],u=t[6],l=t[7],d=t[8],c=t[9],h=t[10],f=t[11],v=t[12],_=t[13],p=t[14],g=t[15],b=r*s-a*o,m=r*u-n*o,y=r*l-i*o,P=a*u-n*s,T=a*l-i*s,x=n*l-i*u,S=d*_-c*v,O=d*p-h*v,E=d*g-f*v,M=c*p-h*_,R=c*g-f*_,w=h*g-f*p,B=b*w-m*R+y*M+P*E-T*O+x*S;if(!B)return!1;B=1/B;var A=e.tmpMatrix._val;return A[0]=(s*w-u*R+l*M)*B,A[1]=(n*R-a*w-i*M)*B,A[2]=(_*x-p*T+g*P)*B,A[3]=(h*T-c*x-f*P)*B,A[4]=(u*E-o*w-l*O)*B,A[5]=(r*w-n*E+i*O)*B,A[6]=(p*y-v*x-g*m)*B,A[7]=(d*x-h*y+f*m)*B,A[8]=(o*R-s*E+l*S)*B,A[9]=(a*E-r*R-i*S)*B,A[10]=(v*T-_*y+g*b)*B,A[11]=(c*y-d*T-f*b)*B,A[12]=(s*O-o*M-u*S)*B,A[13]=(r*M-a*O+n*S)*B,A[14]=(_*m-v*P-p*b)*B,A[15]=(d*P-c*m+h*b)*B,this.swapWithTmpMatrix(),!0},e.prototype.perspective=function(e,t,r,a){var n=1/Math.tan(e/2);if(this._val[0]=n/t,this._val[1]=0,this._val[2]=0,this._val[3]=0,this._val[4]=0,this._val[5]=n,this._val[6]=0,this._val[7]=0,this._val[8]=0,this._val[9]=0,this._val[11]=-1,this._val[12]=0,this._val[13]=0,this._val[15]=0,a===1/0)this._val[10]=-1,this._val[14]=-2*r;else{var i=1/(r-a);this._val[10]=(a+r)*i,this._val[14]=2*a*r*i}},e.prototype.perspectiveInverse=function(e,t,r,a){var n=Math.tan(e/2);if(this._val[0]=t*n,this._val[1]=0,this._val[2]=0,this._val[3]=0,this._val[4]=0,this._val[5]=n,this._val[6]=0,this._val[7]=0,this._val[8]=0,this._val[9]=0,this._val[10]=0,this._val[12]=0,this._val[13]=0,this._val[14]=-1,a===1/0)this._val[11]=-.5,this._val[15]=.5/r;else{var i=.5/(r*a);this._val[11]=(r-a)*i,this._val[15]=(r+a)*i}},e.prototype.swapWithTmpMatrix=function(){var t=e.tmpMatrix._val;e.tmpMatrix._val=this._val,this._val=t},e._tmpMatrix=null,e}();t.Mat4=n}]);
//# sourceMappingURL=main.min.js.map